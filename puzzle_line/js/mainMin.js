function counter(){if(time>0){time--;timeHud.innerHTML=time;setTimeout(function(){counter()},1e3)}else{timeHud.innerHTML=time}}var doc=document,scripts=["transitions.js"],time=300,points=0,pointsHud=doc.getElementById("points"),timeHud=doc.getElementById("time");timeHud.innerHTML=time;pointsHud.innerHTML=points;for(var i=0;i<scripts.length;i++){doc.writeln("<scripts src='js/"+scripts[i]+"'></scripts>")}window.addEventListener("load",function(){document.getElementById("game").setAttribute("class","screen screen-true center")},false);window.addEventListener("transitionend",function(){},false);circleBrain=gamvas.ActorState.extend({value:0,update:function(){if(this.actor.scaleFactor<1&&this.actor.alive){this.actor.scale(.025)}if(this.actor.scaleFactor>0&&!this.actor.alive){this.actor.scale(-.025)}if(this.actor.isMoving&&this.actor.position.x>this.actor.newPos.x){this.actor.move(-10,0)}else if(this.actor.isMoving&&this.actor.position.x<this.actor.newPos.x){this.actor.move(10,0)}else if(this.actor.isMoving&&this.actor.position.y>this.actor.newPos.y){this.actor.move(0,-10)}else if(this.actor.isMoving&&this.actor.position.y<this.actor.newPos.y){this.actor.move(0,10)}else{this.actor.isMoving=false}if(this.actor.position.x>240){if(this.actor.position.y<240){this.actor.rotation=Math.PI+Math.atan((this.actor.position.x-240)/(240-this.actor.position.y))}else{this.actor.rotation=-Math.atan((this.actor.position.x-240)/(this.actor.position.y-240))}}else{if(this.actor.position.y<240){this.actor.rotation=Math.PI-Math.atan((240-this.actor.position.x)/(240-this.actor.position.y))}else{this.actor.rotation=Math.atan((240-this.actor.position.x)/(this.actor.position.y-240))}}}});circle=gamvas.Actor.extend({create:function(e,t,n,r,i){this._super(e,t,n);this.setCenter(35,30);this.setScale(0);this.resource=gamvas.state.getCurrentState().resource;this.rotation=this.position.y>240?Math.atan((240-this.position.x)/(240-this.position.y))*-1:Math.PI-Math.atan((240-this.position.x)/(240-this.position.y));this.type=i;this.isMoving=false;this.alive=true;this.setFile(r,70,73,10,1);this.setFrameList([i]);this.rect={x:this.position.x-30,y:this.position.y-30,w:60,h:60};this.addState(new circleBrain("b"),true);this.newPos={x:t,y:n};this.resource=gamvas.state.getCurrentState().resource}});gameplay=gamvas.State.extend({init:function(){this.camera.setPosition(240,240);this.clearColor="rgba(0,0,0,0)";this.table=new Array(new Array,new Array,new Array,new Array,new Array,new Array);this.level=1;this.numPieces=0;this.creationTime=1500;this.elapsedTime=0;this.shadow=new gamvas.Image(this.resource.getImage("./img/shadow.png"));this.back=new gamvas.Image(this.resource.getImage("./img/table.png"));this.pieces=this.resource.getImage("./img/ball.svg");this.active=new gamvas.Image(this.resource.getImage("./img/active.png"),0,0);for(var e=0;e<6;e++){for(var t=0;t<6;t++){this.table[e].push({x:e*80,y:t*80,w:80,h:80,c:null,active:false})}}this.table[0][0]=this.table[0][5]=this.table[5][0]=this.table[5][5]=null},preDraw:function(){this.back.draw();for(var e=0;e<6;e++){for(var t=0;t<6;t++){if(this.table[e][t]!=null&&this.table[e][t].active){this.active.setPosition(e*80,t*80);this.active.draw()}}}pointsHud.innerHTML=gamvas.screen.getFPS()},draw:function(){if(this.elapsedTime>=this.creationTime){var e=0,t=0;if(this.numPieces<10){while(e==0&&t==0||e==5&&t==0||e==0&&t==5||e==5&&t==5||this.table[e][t].c!=null){e=Math.round(Math.random()*10)%6;t=Math.round(Math.random()*10)%6}this.table[e][t].c=new circle("c"+this.numPieces,e*80+40,t*80+40,this.pieces,Math.round(Math.random()*10)%this.level);this.addActor(this.table[e][t].c);this.numPieces++}this.elapsedTime=0}else{this.elapsedTime+=10}},postDraw:function(){this.shadow.draw()},collide:function(e,t){return!(e.x>t.x+t.w||e.x+e.w<t.x||e.y>t.y+t.h||e.y+e.h<t.y)},verifyLine:function(){var e;for(var t=1;t<5;t++){e=true;for(var n=1;n<4;n++){if(this.table[t][n].c.type!=this.table[t][n+1].c.type){e=false;n=4}}if(e){for(var n=1;n<4;n++){if(this.table[t][n].c.type!=this.table[t][n+1].c.type){e=false;n=4}}}}},onMouseUp:function(e){if(e==gamvas.mouse.LEFT){for(var t=0;t<6;t++){for(var n=0;n<6;n++){if(this.table[t][n]!=null){if(this.table[t][n].c!=null&&!this.table[t][n].c.isMoving&&this.collide(this.table[t][n],{x:gamvas.mouse.getX(),y:gamvas.mouse.getY(),w:1,h:1})){if(this.actualPiece!=null){this.lastHouse.c=this.actualPiece;for(var r=0;r<6;r++){for(var e=0;e<6;e++){if(this.table[r][e]!=null&&this.table[r][e].active){this.table[r][e].active=false}}}}this.actualPiece=this.table[t][n].c;this.table[t][n].c=null;this.lastHouse=this.table[t][n];for(var i=t+1;i<6;i++){if(this.table[i][n]!=null&&this.table[i][n].c==null){this.table[i][n].active=true}else{i=6}}for(var i=t-1;i>-1;i--){if(this.table[i][n]!=null&&this.table[i][n].c==null){this.table[i][n].active=true}else{i=-1}}for(var i=n+1;i<6;i++){if(this.table[t][i]!=null&&this.table[t][i].c==null){this.table[t][i].active=true}else{i=6}}for(var i=n-1;i>-1;i--){if(this.table[t][i]!=null&&this.table[t][i].c==null){this.table[t][i].active=true}else{i=-1}}n=6;t=6}else if(this.table[t][n].active&&this.collide(this.table[t][n],{x:gamvas.mouse.getX(),y:gamvas.mouse.getY(),w:1,h:1})){this.actualPiece.newPos.x=this.table[t][n].x+40;this.actualPiece.newPos.y=this.table[t][n].y+40;this.actualPiece.isMoving=true;this.table[t][n].c=this.actualPiece;this.actualPiece=null;for(var r=0;r<6;r++){for(var e=0;e<6;e++){if(this.table[r][e]!=null&&this.table[r][e].active){this.table[r][e].active=false}}}}}}}}}});gamvas.event.addOnLoad(function(){gamvas.state.addState(new gameplay("gameplay"));gamvas.start("c")})